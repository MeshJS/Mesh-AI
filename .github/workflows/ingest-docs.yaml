name: Automate docs ingestion

on:
    push:
        branches:
            - main
        paths:
            - "apps/docs/content/docs"

jobs:
    trigger_ingest:
        runs-on: ubuntu-latest
        steps:
            - name: Call backend ingest docs endpoint
              run: |
                echo "Triggering docs ingestion"
                response=$(curl --fail --silent --show-error \
                    -X POST "${{ secrets.BACKEND_BASE_URL }}/ingest/docs" \
                    -H "Authorization: Bearer ${{ secrets.INGEST_KEY }}" \
                    -H "Accept: application/json")

                echo "Ingestion response: $response"